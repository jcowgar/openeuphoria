#!/bin/sh

UNAME_SYSTEM=`(uname -s) 2>/dev/null`  || UNAME_SYSTEM=unknown

if [ -e source/global.e ]; then
	PREFIX=source/
else
	PREFIX=./
fi

if [ `grep -e "EBSD.*TRUE" "$PREFIX"common.e` ]; then
	ECONFIG=BSD
else
	ECONFIG=LINUX
fi


if test $UNAME_SYSTEM = "Linux"; then
	echo EU_VERSION=`grep -e INTERPRETER_VERSION "$PREFIX"global.e | sed -re "s/^[^0-9\.]*([0-9\.]+)[^0-9\.]*$/\1/"` > "$PREFIX"Makefile.eu
	echo EBSD= >> "$PREFIX"Makefile.eu
else
	echo EU_VERSION=`grep -e INTERPRETER_VERSION "$PREFIX"global.e | sed -Ee "s/^[^0-9\.]*([0-9\.]+)[^0-9\.]*$/\1/"` > "$PREFIX"Makefile.eu
	echo EBSD=1 >> "$PREFIX"Makefile.eu
fi

case "${UNAME_SYSTEM}:${ECONFIG}" in
	Linux:BSD)
		echo 1
		sed -ri -e "s/EBSD = TRUE/EBSD = FALSE/" "$PREFIX"common.e
		;;
	*BSD:LINUX)
		echo 2
		sed -Ei .bsd -e "s/EBSD = FALSE/EBSD = TRUE/" "$PREFIX"common.e
		;;
	*)
		# do nothing
		;;
esac
